<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit</title>
    <link rel="stylesheet" href="../static/css/submit_success.css">
</head>
<body>
    <div class="submit-pg-txt">
        <h1>Form submitted successfully!</h1>
        <h2>Please wait while Moral Compass generates a report for you.</h2>
    </div>
    <div id="report-area" class="submit-pg-txt" style="margin-top:20px;">
        <p id="report-status">Checking report status‚Ä¶</p>
        <div id="report-buttons" style="display:none; margin-top:20px;">
            <a id="view-btn" href="#" target="_blank" class="report-btn view-btn">üìÑ View Report</a>
            <a id="download-btn" href="#" download class="report-btn download-btn">‚¨áÔ∏è Download Report</a>
        </div>
    </div>
    <script>
        // Poll /reports/status every 3 seconds and show buttons when ready
        const statusEl = document.getElementById('report-status');
        const buttonsEl = document.getElementById('report-buttons');
        const viewBtn = document.getElementById('view-btn');
        const downloadBtn = document.getElementById('download-btn');

        async function checkStatus(){
            try{
                const r = await fetch('/reports/status');
                const j = await r.json();
                if (j.ready){
                    statusEl.textContent = '‚úÖ Report ready!';
                    statusEl.style.color = '#28a745';
                    statusEl.style.fontWeight = 'bold';

                    // Set up buttons
                    viewBtn.href = j.url;
                    downloadBtn.href = j.url + '?download=1';
                    buttonsEl.style.display = 'block';

                    // stop polling
                    clearInterval(poller);
                } else {
                    statusEl.textContent = '‚è≥ Report is still being generated ‚Äî please wait...';
                }
            } catch(e){
                statusEl.textContent = '‚ùå Error checking report status.';
                statusEl.style.color = '#dc3545';
                console.error(e);
            }
        }

        const poller = setInterval(checkStatus, 3000);
        // kick one off immediately
        checkStatus();
    </script>
</body>
</html>